# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
PortSystem          1.0

set _arch           x86_64    
set _name           gcc 
set _prefix         mingw-w64
set crossgcc-target ${_arch}-w64-mingw32
set _sysroot        ${prefix}/${crossgcc-target}

name                ${_arch}-${_prefix}-${_name}
version             4.8.3
categories          cross devel
maintainers         openmaintainer

description         Binutils for ${_arch}-${_prefix} cross development
long_description    ${_prefix} development toolchain ("binutils") \
                    for ${_arch}-${_prefix} (Windows) cross development.
homepage            http://www.gnu.org/software/binutils/
license             gpl

platforms           darwin

depends_lib         port:${_arch}-${_prefix}-headers \
                    port:${_arch}-${_prefix}-deps

master_sites        gnu:${_name}/${_name}-${version}/${_name}-${version}.tar.bz2
distname            ${_name}-${version}
worksrcdir          ${_name}-${version}
use_bzip2           yes

checksums           rmd160 2c7214ff607cbe822282c04d1d6f9fea765c82c5 \
                    sha256 6a8e4f11b185f4fe2ed9d7fc053e80f8c7e73f800c045f51f9d8bea33f080f1e

                    
pre-configure       { system "cd ${workpath} && mkdir -p build"}
configure.dir       ${workpath}/build
configure.cmd       ${worksrcpath}/configure
configure.args      --target=${crossgcc-target} --prefix=${_sysroot} --with-sysroot=${_sysroot} \
                    --disable-multilib --with-mpc=${_sysroot} --with-mpfr=${_sysroot} --with-gmp=${_sysroot}  \
                    --with-cloog=${_sysroot} --with-isl=${_sysroot} --with-host-libstdcxx="-lstdc++"  \
                    --enable-languages="c c++"\
                    --enable-threads=win32 --enable-fully-dynamic-string --enable-lto --disable-werror \
                    --disable-isl-version-check
if {${os.platform} eq "darwin" && ${build_arch} ne ""} {
    configure.args-append --build=${build_arch}-apple-darwin${os.major}
}

build.target        all-gcc
build.dir           ${workpath}/build

destroot.violate_mtree  yes
destroot.target     install-gcc




